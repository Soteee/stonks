<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title th:text="${user.username}">No se encontr√≥ el usuario</title>
    <th:block th:replace="fragments/head ::header" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.2/css/bulma.min.css">
</head>

<body>

    <nav th:replace="fragments/menu.html :: topbar"></nav>

    <div class="visualizer">

        <h1>Datos de <span th:text="${user.username}"></span></h1>

        <h2>Nombre completo</h2>
        <div><span th:text="${user.name}"></span> <span th:text="${user.firstName}"></span> <span th:text="${user.lastName}"></span></div>

        <h2>Roles</h2>
        <div th:text="${user.roles}"></div>

        <h1>Salas de <span th:text="${user.username}"></span></h1>
        <ul><li th:each="room: ${user_rooms}"><a th:text="${room.name}" th:href="@{/r/{id}(id=${room.id})}" th:id="${room.name}">No se han encntrado salas</a></li></ul>

        <p>Partidas ganadas: <span th:text="${user.wonRooms}"></span></p>
        <!-- TODO activo en salas..., Ganancias, etc -->
        <div>
            <button id="buttonFollow"></button>
        </div>
    </div>
    <script th:inline="javascript">
        function updateFollowButton(){
            let follow_button = document.getElementById('buttonFollow');

            go(config.rootUrl + 'api/isFollowing?u=' + /*[[${user.id}]]*/ + '', 'GET')
            .then(function(response){
                console.log(response)
                if(response.result){
                    follow_button.setAttribute('class', 'button is-Success');
                    follow_button.innerHTML = "Dejar de seguir";
                    action = "unfollow";
                }
                else {
                    follow_button.setAttribute('class', 'button is-info');
                    follow_button.innerHTML = "Seguir";
                    action = "follow";
                }
            })
        }
        updateFollowButton()

        document.addEventListener("DOMContentLoaded", () => {
            let b = document.getElementById('buttonFollow');
            b.onclick = (e)=>{
                e.preventDefault();

                go(config.rootUrl + 'api/' + action, 'POST', {
                    user: /*[[${user.id}]]*/ ""
                })
                .then((data)=>{
                    updateFollowButton()
                });
            }
        });
    </script>   
    
</body>
</html>